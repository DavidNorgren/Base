CMAKE_MINIMUM_REQUIRED(VERSION 3.7)

# Set project
SET(PROJECTNAME Base)
SET(CMAKE_BUILD_TYPE Debug)
SET(CMAKE_CXX_STANDARD 11)
SET(CMAKE_CXX_FLAGS "-g")
SET(CMAKE_CXX_FLAGS_DEBUG "-g")
SET(LIBS_DIR "../Libs")
PROJECT(${PROJECTNAME})

# Generate object file containing resources on build
# The resouces are fetched from /res in the initial source directory
ADD_CUSTOM_COMMAND(
    OUTPUT "res.o"
    COMMAND zip -r "${CMAKE_CURRENT_BINARY_DIR}/res.zip" *
    COMMAND cd "${CMAKE_CURRENT_BINARY_DIR}" && ld -r -b binary -o "res.o" "res.zip"
    WORKING_DIRECTORY "${CMAKE_SOURCE_DIR}/res"
)
SET_SOURCE_FILES_PROPERTIES(
    "res.o"
    PROPERTIES
    EXTERNAL_OBJECT true
    GENERATED true
)

# Add Base sources
INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}")
FILE(GLOB_RECURSE BASE_SRCS "*.cpp")
FILE(GLOB_RECURSE BASE_HDRS "*.hpp")
ADD_LIBRARY(${PROJECTNAME} STATIC ${BASE_SRCS} ${BASE_HDRS} "res.o")

# Add SOIL
INCLUDE_DIRECTORIES("${LIBS_DIR}/soil")
TARGET_INCLUDE_DIRECTORIES(${PROJECTNAME} PUBLIC "${LIBS_DIR}/soil")
FILE(GLOB SOIL_SRCS "${LIBS_DIR}/soil/*.c")
ADD_LIBRARY(soil STATIC ${SOIL_SRCS})

# Add GLFW (CMake)
INCLUDE_DIRECTORIES("${LIBS_DIR}/glfw/include")
TARGET_INCLUDE_DIRECTORIES(${PROJECTNAME} PUBLIC "${LIBS_DIR}/glfw/include")
ADD_SUBDIRECTORY("${LIBS_DIR}/glfw" "${CMAKE_CURRENT_BINARY_DIR}/glfw")

# Add Libzip
INCLUDE_DIRECTORIES("${LIBS_DIR}/libzip/lib")
TARGET_INCLUDE_DIRECTORIES(${PROJECTNAME} PUBLIC "${LIBS_DIR}/libzip/lib")
FILE(GLOB LIBZIP_SRCS "${LIBS_DIR}/libzip/lib/*.c")
ADD_LIBRARY(libzip STATIC ${LIBZIP_SRCS})

# Add FreeType (CMake)
INCLUDE_DIRECTORIES("${LIBS_DIR}/freetype/include")
TARGET_INCLUDE_DIRECTORIES(${PROJECTNAME} PUBLIC "${LIBS_DIR}/freetype/include")
ADD_SUBDIRECTORY("${LIBS_DIR}/freetype" "${CMAKE_CURRENT_BINARY_DIR}/freetype")

# Add GLEW
INCLUDE_DIRECTORIES("${LIBS_DIR}/glew/include")
TARGET_INCLUDE_DIRECTORIES(${PROJECTNAME} PUBLIC "${LIBS_DIR}/glew/include")
FILE(GLOB GLEW_SRCS "${LIBS_DIR}/glew/src/*.c")
ADD_LIBRARY(glew STATIC ${GLEW_SRCS})

# Add Zlib
INCLUDE_DIRECTORIES("${LIBS_DIR}/zlib")
TARGET_INCLUDE_DIRECTORIES(${PROJECTNAME} PUBLIC "${LIBS_DIR}/zlib")
FILE(GLOB ZLIB_SRCS "${LIBS_DIR}/zlib/*.c")
ADD_LIBRARY(zlib STATIC ${ZLIB_SRCS})

TARGET_LINK_LIBRARIES(${PROJECTNAME} soil glfw libzip freetype glew opengl32 zlib)